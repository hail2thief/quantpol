---
title: "Correlation and regression"
citeproc: true
bibliography: ../../static/bib/references.bib
csl: ../../static/bib/chicago-fullnote-bibliography-no-bib.csl
menu: 
  class:
    parent: Class
    weight: 5
type: docs
output:
  blogdown::html_page:
    toc: true
editor_options: 
  chunk_output_type: console
---


## In-class example


Here's the code we'll be using in class. Download it and store it with the rest of your materials for this course. If simply clicking doesn't trigger download, you should right-click and select "save link as..."

[<i class="fas fa-file-archive"></i> `04-models.R`](/slides/code/04-models.R)




## Drawing lines (geom_smooth)


Why draw trend lines? Trend lines give us a good, educated guess as to what the value of a Y variable is given some value of X. We can draw a trend line (or line of best fit) using `geom_smooth`, as below. Notice `method = "lm"`. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r, warning=F,message=F}
# libraries
library(tidyverse)

# mtcars
ggplot(mtcars, aes(x = wt, y = mpg)) + geom_point() + 
  geom_smooth(method = "lm")
```



## ggcorrplot


```{r}
# libraries
library(tidyverse)
library(socviz)
library(fivethirtyeight)
library(gapminder)
library(nycflights13)
library(ggcorrplot)

# load data
therm = read_csv("../../static/files/voter-files-therm.csv")

issues = read_csv("../../static/files/voter-files-issues.csv")
```


Look at the correlations:

```{r}
# switch out gapminder with a dataset you want below
therm %>% 
  # correlation only works with numeric columns; keep only those
  select(where(is.numeric)) %>% 
  # the cor() function doesn't take NA; drop them all
  drop_na() %>% 
  # get the correlation
  cor() %>% 
  # plot the correlation
  ggcorrplot(lab = TRUE)
```


## Draw the line

```{r}
# draw a line: alter the intercept and slope in geom_abline()
# to draw the line
  ggplot() + geom_abline(intercept = 1, slope = 2, size = 1) + 
  # change the limits on the x and y-axis
  scale_x_continuous(limits = c(-10, 10)) + 
  scale_y_continuous(limits = c(-10, 10)) + 
  # add a vertical and horizontal line at 0
  geom_hline(yintercept = 0, lty = 2) + 
  geom_vline(xintercept = 0, lty = 2) + 
  theme_bw()

```


## Convince yourself


Make the scatterplot:

```{r}
# convince yourself about the line of best fit: run this code below
# set the seed
set.seed(1990)

# make the fake data
df = tibble(x = rnorm(50, mean = 10), 
            y = 3 + 2*x + rnorm(50))

# line of best fit?
model = lm(y ~ x, df)
true = tibble(true_intercept = coef(model)[1], 
              true_slope = coef(model)[2])

ggplot(data = df, aes(x = x, y = y)) + 
  geom_point() + 
  geom_smooth(method = "lm")
```

