---
title: "Relationships II"
subtitle: "The Scientific Study of Politics"  
author: 
  - "Juan Tellez"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: "libs"
    css: ["default", "css/my-theme.css", "css/ath-inferno-fonts.css"]
    seal: false
    nature:
      highlightStyle: github
      highlightLanguage: ["r"]
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
      ratio: "16:9"
      navigation:
        scroll: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, 
  fig.height=3.5, 
  fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = FALSE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)
```



```{r packages}
library(tidyverse)
library(gapminder)
library(fivethirtyeight)

# dubois colors
red = "#dc354a"
yellow = "#ecb025"
blue = "#213772"



# elections
pokemon = read_csv("../files/pokemon.csv")


# thermometer
therm = read_csv("../files/voter-files-therm.csv")


# fancy theme
fancy_theme <- theme_bw(base_family = "Fira Sans", base_size = 14)

```



class: left, middle
background-image: url("images/dubois-spiral-2.png")
background-position: right
background-size: contain

# `r rmarkdown::metadata$title`

### *`r rmarkdown::metadata$subtitle`*

### Professor `r rmarkdown::metadata$author` 

#### University of California, Davis

---

class: center
.large[
# Today's agenda
]

--
.box-1.large.sp-after[Comparing across groups]

--
.box-2.large.sp-after[Dummy variables]

--
.box-3.large.sp-after[Categorical variables]

---



# The feeling thermometer


We can use `summarise()` to measure average support for different groups:

```{r, echo = TRUE}
therm %>% 
  summarise(avg_police = mean(ft_police_2017, na.rm = TRUE)) #<<
```


---

# Feeling thermometer


We can *compare* where support is highest and lowest:

```{r, echo = TRUE}
therm %>% 
  summarise(avg_police = mean(ft_police_2017, na.rm = TRUE), 
            avg_muslim = mean(ft_muslim_2017, na.rm = TRUE), #<<
            avg_white = mean(ft_white_2017, na.rm = TRUE), #<<
            avg_immig = mean(ft_christ_2017, na.rm = TRUE), #<<
            avg_fem = mean(ft_fem_2017, na.rm = TRUE), #<<
            avg_black = mean(ft_black_2017, na.rm = TRUE)) #<<
```

??? 
Patterns?

---

# The secret shortcut

```{r, echo = TRUE}
therm %>% 
  summarise(across(c(ft_black_2017:ft_rep_2017), ~mean(.,na.rm = TRUE))) #<<
```


You're not responsible for this!

---


# Breaking down support

We can look for patterns by using `group_by()` to separate average support *by* respondent characteristics:

--

.scroll-output[
```{r, echo = TRUE}
therm %>% 
  group_by(party_id) %>% #<<
  summarise(avg_police = mean(ft_police_2017, na.rm = TRUE), avg_muslim = mean(ft_muslim_2017, na.rm = TRUE), avg_white = mean(ft_white_2017, na.rm = TRUE), avg_immig = mean(ft_christ_2017, na.rm = TRUE), avg_fem = mean(ft_fem_2017, na.rm = TRUE), avg_black = mean(ft_black_2017, na.rm = TRUE))
```
]

???
Take code and iteratively change it
---


# Breaking down support

We can use `filter()` to focus our search on fewer categories: 

--

.scroll-output[
```{r, echo = TRUE}
therm %>% 
  filter(party_id %in% c("Democrat", "Republican", "Independent")) %>% #<<
  group_by(party_id) %>% 
  summarise(avg_police = mean(ft_police_2017, na.rm = TRUE),avg_muslim = mean(ft_muslim_2017, na.rm = TRUE), avg_white = mean(ft_white_2017, na.rm = TRUE),avg_immig = mean(ft_christ_2017, na.rm = TRUE),avg_fem = mean(ft_fem_2017, na.rm = TRUE),avg_black = mean(ft_black_2017, na.rm = TRUE))
```
]


???
Where are the biggest partisan gaps? 
What's going on with feminism? Is this really an apples-to-apples comparison? 

---

class: center, middle, inverse
# Making sense of the feminism gap

--

The problem with the feminism finding is that women trend Democrat

--

Might be that Republicans have much worse opinions of feminists than Democrats

--

**or**: it might be that there are just more women who ID as Democrats, 

--

**and** women are more likely to be feminists than men

---

# Making sense of the feminism gap

We can "test" this concern by breaking the data down further, by sex: 

--

```{r, echo = TRUE}
therm %>% 
  filter(party_id %in% c("Democrat", "Republican", "Independent")) %>%
  group_by(party_id, sex) %>% #<<
  summarise(avg_fem = mean(ft_fem_2017, na.rm = TRUE))
```


---


# Visualizing the pattern

We can create a new object to make a nice plot:

```{r, echo = TRUE}
therm_party_sex = therm %>% #<<
  filter(party_id %in% c("Democrat", "Republican", "Independent")) %>%
  group_by(party_id, sex) %>%
  summarise(avg_fem = mean(ft_fem_2017, na.rm = TRUE))
```

---

# The plot

```{r, echo = TRUE, out.width="80%"}
ggplot(therm_party_sex, aes(x = party_id, y = avg_fem, fill = sex)) + 
  geom_col() #<<
```

---

# The better plot

`position = "dodge"` "unstacks" the columns

```{r,echo = TRUE, out.width="80%"}
ggplot(therm_party_sex, aes(x = party_id, y = avg_fem, fill = sex)) + 
  geom_col(position = "dodge") #<<
```

---

class: center, middle, inverse
# Big picture


The feminism gap persists, even comparing men against men and women against women

--

We can use `summarise` and `group_by` to compare averages across groups

--

Big differences **across groups** should raise eyebrows; what's going on here? 

--

We can break the data down further to see what's going on beneath the surface

---

# Non-differences can be surprsing too


```{r, echo = TRUE}
therm %>% 
  summarise(avg_dems = mean(ft_dem_2017, na.rm = TRUE), 
            avg_reps = mean(ft_rep_2017, na.rm = TRUE))
```

--

Pretty neutral feelings; mass polarization is dead! Alert the media!!!

---

# Oh...

Breaking down data says something different

--

```{r}
therm %>% 
  group_by(party_id) %>% #<<
  summarise(dems = mean(ft_dem_2017, na.rm = TRUE), 
            reps = mean(ft_rep_2017, na.rm = TRUE))
```

---

# Negative polarization

```{r}
therm %>% 
  filter(party_id %in% c("Democrat", "Republican")) %>% 
  select(party_id, ft_dem_2017, ft_rep_2017) %>% 
  pivot_longer(-party_id) %>% 
  ggplot(aes(x = value, y = name, fill = party_id)) + 
  ggridges::geom_density_ridges(color = "white", alpha = .8) + 
  fancy_theme + 
  scale_y_discrete(labels = c("Democrats", "Republicans")) + 
  theme(legend.position = "top") + 
  labs(y = "How respondents feel about...", 
       x = "Thermometer rating", fill = "Respondent is a...") + 
  scale_fill_brewer(palette = "Set1", direction = -1)
```

---

class: middle, center, inverse
# Nothing is as it first seems

--
# You gotta poke around


---



class: middle, center, inverse
# Dummy variables
---


# Dummy variables

Often, *categorical* variables are coded 0/1 to represent "yes/no" or "presence/absence"

--

```{r}
pokemon %>% 
  select(name, type1, weight_kg, height_m, is_legendary) %>% 
  sample_n(10, weight = is_legendary) %>% 
  knitr::kable()
```

---

class: center, middle
# Dummy proportions

--
When you take the average of a dummy variable you get a **proportion**:

--

Showered today? 1, 0, 0, 0, 1

--


Average of shower = $\frac{1 + 0 + 0 + 0 + 1}{5} = .40$

--

We can think about that proportion as a **probability** or **likelihood**

--

What is the **probability** a random student in class has showered? 2/5 = 40%

???
Convince yourself this is true

---

# Dummy variables


When you take the average of a dummy variable you get a proportion:

```{r}
pokemon %>% 
  summarise(prop_legendary = mean(is_legendary, na.rm = TRUE)) #<<
```

Approximately 8% of pokemon are legendary, or: 

--

there's an 8% **chance** a pokemon is legendary


???
Convince yourself this is true

---


# Dummy variables


Like with anything else, we can take averages by groups

--

For example, are creators making **more** legendary pokemon as time goes on to try to artificially make the show more exciting?

--

.scroll-output[
```{r,echo = TRUE}
pokemon %>% 
  group_by(generation) %>% #<<
  summarise(prop_legendary = mean(is_legendary, na.rm = TRUE))
```
]

---

# Dummy variables


We can store as an object, to make a plot:

```{r,echo=TRUE}
legend_gen = pokemon %>% #<<
  group_by(generation) %>% 
  summarise(prop_legendary = mean(is_legendary, na.rm = TRUE))
```

---

# Legendary pokemon over time

```{r,echo = TRUE, out.width = "90%"}
ggplot(legend_gen, aes(x = generation, y = prop_legendary)) + 
  geom_col(fill = "#324200") + theme_bw()
```

---


# ðŸš¨ Your turn: Bob Ross ðŸš¨

All dummy data on the paintings of Bob Ross

--

.scroll-output[
```{r}
knitr::kable(bob_ross)
```
]

---

# ðŸš¨ Your turn: Bob Ross ðŸš¨

Using the `bob_ross` data (use `?bob_ross` to read about the variables):

.small[
1. How likely was Bob Ross to include a happy little `tree` in one of his paintings? 

2. How has the frequency with which Bob Ross included `clouds` in his paintings changed across the show's seasons? Make a time series to illustrate. 

3. If there is a `mountain` in a Bob Ross painting, how likely is it that mountain is *snowy*?

4. How much more likely was Steve Ross to paint a lake than his dad? 
]


```{r}
countdown::countdown(minutes = 10L)
```

---



class: center, middle, inverse
# Analyzing categorical variables

--

Some variables have values that are **categories** (race, sex, etc.)

--

Can't take the **mean** of a category!

--

But we *can* look at the *proportions* of observations in each category, and look for patterns there

---

# Pokemon types

How many Pokemon are there of each type? What are the most and least common types?


```{r}
pokemon %>% 
  select(name, type1) %>% 
  sample_n(10) %>% 
  knitr::kable()
```

---

# Counting categories


We can use a new function `tally()`, in combination with `group_by()`, to **count** how many observations are in each category:

```{r, echo = TRUE}
pokemon
```

---


# Counting categories


We can use a new function `tally()`, in combination with `group_by()`, to **count** how many observations are in each category:

```{r, echo = TRUE}
pokemon %>% 
  group_by(type1) #<<
```

---

# Counting categories


We can use a new function `tally()`, in combination with `group_by()`, to **count** how many observations are in each category:

.scroll-output[
```{r, echo = TRUE}
pokemon %>% 
  group_by(type1) %>% 
  tally() #<<
```
]


---

# From counts to percents


We can can then use `mutate()` to calculate the **percent** in each group:

.scroll-output[
```{r, echo = TRUE}
pokemon %>% 
  group_by(type1) %>% 
  tally() %>% 
  mutate(percent = n/sum(n)) #<<
```
]


???
stop to show the n/sum(n)

---

# group_by + tally()


We can then store as object for plotting:

```{r, echo = TRUE}
type_pct = pokemon %>% #<<
  group_by(type1) %>% 
  tally() %>% 
  mutate(percent = n/sum(n))
```

---

# group_by + tally()


We can then store as object for plotting:

```{r, echo = TRUE, out.width="80%"}
ggplot(type_pct, aes(x = type1, y = percent)) + 
  geom_col()
```

---

# group_by + tally()


Flip the coordinates for nicer plot:

```{r, echo = TRUE,out.width="80%"}
ggplot(type_pct, aes(x = type1, y = percent)) + 
  geom_col() + coord_flip() #<<
```

---


# group_by + tally()


Pro-tip: you can reorder the x-axis **by** another variable using `reorder()`

```{r, echo = TRUE,out.width="80%"}
ggplot(type_pct, aes(x = reorder(type1, percent), y = percent)) + #<<
  geom_col() + coord_flip()
```

---

# group_by + tally()

```{r}
ggplot(type_pct, aes(x = reorder(type1, percent), y = percent, fill = type1)) + #<<
  geom_col() + coord_flip() + fancy_theme + theme(legend.position = "none") + 
  labs(x = "Type", y = "Percent of Pokemon") + scale_y_continuous(labels = scales::percent)
```

---

# ðŸš¨ Your turn: Flying etiquette ðŸš¨

A survey of what's rude to do on a plane: 
--


.scroll-output[
```{r}
knitr::kable(flying %>% select(-respondent_id) %>% drop_na(gender))
```
]

---


# ðŸš¨ Your turn: flying etiquette ðŸš¨

Using the `flying` data (use `?flying` to read about the variables):

.small[
1. In a row of three seats, who should get to use the middle arm rest (`two_arm_rests`)? Make a barplot of the *percent* of respondents who gave each answer. 

2. In general, is it rude to knowingly bring unruly children on a plane? Make a barplot of the *percent* who gave each answer, but **separated by** whether the respondent has a kid or not. 

3. Make a barplot of responses to an etiquette dilemma of your liking. Bonus points if you break it down by a respondent characteristic. 
]



```{r}
countdown::countdown(minutes = 10L)
```

---

# Weekly check-in


> Okay If the data is accurate I fin it totally awesome that water type pokemon have the highest numbers when it comes to their total combined power. I always chose water type pokemon over any other and it is just great to see. 


> There was a burrito that I got after the last home game. I found that exciting. 

---

# Weekly check-in

- Mutate is hard
- `facet_wrap()` confusion
- Horrified some of you are manually typing out pipes: 
    - OSX: <kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>M</kbd> 
    - Windows: <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>M</kbd> 
- When to use a pipe? When a +? 
    - Pipes are for connecting data to functions, and functions to other functions
    - `+` is only for plotting! to **add** `geom_` and `labs` and `facet_wrap`


